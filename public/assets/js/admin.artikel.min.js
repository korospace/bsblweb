function validateAddKategori(){let t=!0;return $("#formAddKategoriArtikel .form-control").removeClass("is-invalid"),$("#formAddKategoriArtikel .text-danger").html(""),""==$("input#NewKategoriArtikel").val()?($("input#NewKategoriArtikel").addClass("is-invalid"),$("#newkategori-error").html("*masukan kategori"),t=!1):$("input#NewKategoriArtikel").val().length>20?($("input#NewKategoriArtikel").addClass("is-invalid"),$("#newkategori-error").html("*maximal 20 huruf"),t=!1):/[^A-Za-z0-9\| ]/g.test($("input#NewKategoriArtikel").val())&&($("input#NewKategoriArtikel").addClass("is-invalid"),$("#newkategori-error").html("*hanya boleh huruf dan angka"),t=!1),arrayKatArtikel.forEach(e=>{e.name.toLowerCase()==$("input#NewKategoriArtikel").val().toLowerCase().trim()&&($("input#NewKategoriArtikel").addClass("is-invalid"),$("#newkategori-error").html("*kategori sudah tersedia"),t=!1)}),t}function saveTemporaryContent(){let t={title:$("#formCrudArticle #title").val(),kategori:$("#formCrudArticle #kategori-berita-wraper").val(),content:$(".ql-editor").html()};localStorage.setItem("add-artikel",JSON.stringify(t))}function editTemporaryContent(){"tambah artikel"===pageTitle1&&dataTemporaryContent&&($("#formCrudArticle #title").val(dataTemporaryContent.title),dataTemporaryContent.kategori&&$("#formCrudArticle #kategori-berita-wraper").val(dataTemporaryContent.kategori),$(".ql-editor").html(dataTemporaryContent.content))}function validateCrudArtikel(){let t=!0;return $(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),""==IDARTIKEL&&""==$("#thumbnail").val()&&($("#thumbnail").addClass("is-invalid"),t=!1),""==$("#title").val()?($("#title").addClass("is-invalid"),t=!1):$("#title").val().length>250&&($("#title").addClass("is-invalid"),$("#title-error").html("*maximal 250 character"),t=!1),""==$("#kategori-berita-wraper").val()&&($("#kategori-berita-wraper").addClass("is-invalid"),t=!1),t}let arrayKatArtikel=[];const getAllKatBerita=async()=>{$("#list-kategori-spinner").removeClass("d-none"),$("#table-kategori-berita tbody").addClass("d-none");let t=await httpRequestGet(`${APIURL}/artikel/getkategori`);$("#list-kategori-spinner").addClass("d-none"),$("#table-kategori-berita tbody").removeClass("d-none");let e="<option value='' selected>-- pilih kategori --</option>",a="<option value='' selected>-- semua kategori --</option>";if(404==t.status&&$("#list-kategori-notfound").removeClass("d-none"),200===t.status){let i="",l=t.data.data;arrayKatArtikel=t.data.data,l.forEach((t,l)=>{e+=`<option id="${t.id}" value="${t.id}">${t.name}</option>`,a+=`<option id="${t.id}" value="${t.name}">${t.name}</option>`,i+=`<tr class="text-xs">\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold"> ${++l} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span class="font-weight-bold"> ${t.name} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <a href='' id="${t.id}" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusKategori('${t.id}','${t.name}',event)">hapus</a>\n                 </td>\n             </tr>`}),$("#table-kategori-artikel tbody").html(i),$("#formFilterArtikel select[name=kategori]").html(a)}$("#kategori-berita-wraper").html(e),editTemporaryContent()};getAllKatBerita(),$("#formAddKategoriArtikel").on("submit",async function(t){if(t.preventDefault(),validateAddKategori()){let t=new FormData;t.append("kategori_name",$("input#NewKategoriArtikel").val().trim().toLowerCase()),$("#btnAddKategoriBerita #text").addClass("d-none"),$("#btnAddKategoriBerita #spinner").removeClass("d-none");let e=await httpRequestPost(`${APIURL}/artikel/addkategori`,t);$("#btnAddKategoriBerita #text").removeClass("d-none"),$("#btnAddKategoriBerita #spinner").addClass("d-none"),201===e.status&&($("input#NewKategoriArtikel").val(""),getAllKatBerita(),showAlert({message:"<strong>Success...</strong> kategori berhasil ditambah!",autohide:!0,type:"success"}))}});const hapusKategori=(t,e,a)=>{a.preventDefault(),Swal.fire({title:"ANDA YAKIN?",text:`berita dengan kategori '${e}' akan terhapus juga`,icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(e=>{e.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:e=>{let a=new FormData;return a.append("hashedpass",PASSADMIN),a.append("password",e),axios.post(`${APIURL}/admin/confirmdelete`,a,{headers:{}}).then(e=>httpRequestDelete(`${APIURL}/artikel/deletekategori?id=${t}`).then(t=>{201==t.status&&getAllKatBerita()})).catch(t=>{404==t.response.status?Swal.showValidationMessage("password salah"):500==t.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},filterArtikel=async t=>{let e=new FormData(t.parentElement.parentElement.parentElement),a=`${e.get("orderby")} - `;artikelUrl=`${APIURL}/artikel/getartikel?orderby=${e.get("orderby")}`,e.get("kategori")&&(a+=`${e.get("kategori")}`,artikelUrl+=`&kategori=${e.get("kategori")}`),""==e.get("kategori")&&(a=`${e.get("orderby")} - semua kategori`,artikelUrl=`${APIURL}/artikel/getartikel?orderby=${e.get("orderby")}`),$("#ket-filter").html(a),getAllBerita()},resetFilterArtikel=async t=>{$("#formFilterArtikel select[name=orderby]").val("terbaru"),$("#formFilterArtikel select[name=kategori]").val("")};let arrayBerita=[],artikelUrl=`${APIURL}/artikel/getartikel?orderby=terbaru`;const getAllBerita=async()=>{$("#search-artikel").val(""),$("#ket-total").html("0"),$("#container-list-artikel").html(""),$("#list-artikel-notfound").addClass("d-none"),$("#list-artikel-spinner").removeClass("d-none");let t=await httpRequestGet(artikelUrl);if($("#list-artikel-spinner").addClass("d-none"),404===t.status)arrayBerita=[],$("#list-artikel-notfound").removeClass("d-none"),$("#list-artikel-notfound #text-notfound").html("artikel belum ditambah");else if(200===t.status){let e="",a=t.data.data;arrayBerita=a,a.forEach(t=>{let a=new Date(1e3*parseInt(t.created_at)),i=a.toLocaleString("en-US",{day:"numeric"}),l=a.toLocaleString("en-US",{month:"long"}),r=a.toLocaleString("en-US",{year:"numeric"});e+=`<div class="col-12 col-sm-6 col-lg-4 mb-4" style="min-height: 100%;">\n            <div class="card" style="border: 0.5px solid #D2D6DA;min-height: 100%;">\n                <div class="position-relative">\n                    <img class="card-img-top border-radius-0 position-absolute" style="z-index: 10;min-width: 100%;max-width: 100%;max-height: 100%;;min-height: 100%;" src="${t.thumbnail}" style="opacity: 0;">\n                    <img class="card-img-top border-radius-0" src="${BASEURL}/assets/images/default-thumbnail.jpg" style="opacity: 0;">\n                </div>\n                <div class="card-body pb-0 d-flex flex-column justify-content-between" style="font-family: 'qc-semibold';">\n                    <div class="row">\n                        <h4 class="card-title text-capitalize" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">${t.title}</h4>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="fas fa-list-ul mr-1 text-muted text-xs"></i>\n                            ${t.kategori}\n                        </h6>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="far fa-clock mr-1 text-muted text-xs"></i>\n                            ${l}, ${i}, ${r}\n                        </h6>\n                        <h6 class="card-subtitle text-muted text-sm" style="display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">\n                            <i class="fas fa-user-edit mr-1 text-muted text-xs"></i>\n                            ${t.penulis}\n                        </h6>\n                    </div>\n                    <div class="row mt-3">\n                        <div class="col-6">\n                            <a href="${BASEURL}/admin/editartikel/${t.id}" class="w-100 btn btn-warning p-2 border-radius-sm" style="height: 34px;">\n                                <i class="far fa-edit"></i>\n                            </a>\n                        </div>\n                        <div class="col-6">\n                            <span class="w-100 btn btn-danger p-2 border-radius-sm" style="height: 34px;" onclick="hapusArtikel('${t.id}');">\n                                <i class="fas fa-trash text-white"></i>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`}),$("#ket-total").html(a.length),$("#container-list-artikel").html(e)}};if($("#search-artikel").on("keyup",function(){let t="",e=[];e=""===$(this).val()?arrayBerita:arrayBerita.filter(t=>t.title.includes($(this).val())||t.kategori.includes($(this).val())),0==e.length?($("#list-artikel-notfound").removeClass("d-none"),$("#list-artikel-notfound #text-notfound").html("artikel tidak ditemukan")):($("#list-artikel-notfound").addClass("d-none"),$("#list-artikel-notfound #text-notfound").html(" "),e.forEach(e=>{let a=new Date(1e3*parseInt(e.created_at)),i=a.toLocaleString("en-US",{day:"numeric"}),l=a.toLocaleString("en-US",{month:"long"}),r=a.toLocaleString("en-US",{year:"numeric"});t+=`<div class="col-12 col-sm-6 col-lg-4" style="min-height: 100%;">\n            <div class="card mb-3" style="border: 0.5px solid #D2D6DA;min-height: 100%;">\n                <div class="position-relative">\n                    <img class="card-img-top border-radius-0 position-absolute" style="z-index: 10;min-width: 100%;max-width: 100%;max-height: 100%;;min-height: 100%;" src="${e.thumbnail}" style="opacity: 0;">\n                    <img class="card-img-top border-radius-0" src="${BASEURL}/assets/images/default-thumbnail.jpg" style="opacity: 0;">\n                </div>\n                <div class="card-body pb-0 d-flex flex-column justify-content-between" style="font-family: 'qc-semibold';">\n                    <div class="row">\n                        <h4 class="card-title text-capitalize" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">${e.title}</h4>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="fas fa-list-ul mr-1 text-muted text-xs"></i>\n                            ${e.kategori}\n                        </h6>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="far fa-clock mr-1 text-muted text-xs"></i>\n                            ${l}, ${i}, ${r}\n                        </h6>\n                        <h6 class="card-subtitle text-muted text-sm" style="display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">\n                            <i class="fas fa-user-edit mr-1 text-muted text-xs"></i>\n                            ${e.penulis}\n                        </h6>\n                    </div>\n                    <div class="row">\n                        <div class="col-6">\n                            <a href="${BASEURL}/admin/editartikel/${e.id}" class="w-100 btn btn-warning p-2 border-radius-sm" style="height: 34px;">\n                                <i class="far fa-edit"></i>\n                            </a>\n                        </div>\n                        <div class="col-6">\n                            <span class="w-100 btn btn-danger p-2 border-radius-sm" style="height: 34px;" onclick="hapusArtikel('${e.id}');">\n                                <i class="fas fa-trash text-white"></i>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`})),$("#ket-total").html(e.length),$("#container-list-artikel").html(t)}),"tambah artikel"===pageTitle2||"edit artikel"===pageTitle2){Quill.register("modules/imageCompressor",imageCompressor);var quill=new Quill("#editor-container",{modules:{imageResize:{displaySize:!0,debug:!1},imageCompressor:{quality:.9,imageType:"image/jpeg",debug:!1},formula:!0,syntax:!0,toolbar:"#toolbar-container"},theme:"snow"})}const getDetailBerita=async()=>{showLoadingSpinner();let t=await httpRequestGet(`${APIURL}/artikel/getartikel?id=${IDARTIKEL}`);if(hideLoadingSpinner(),404==t.status&&Swal.fire({icon:"error",title:"<strong>NOT FOUND</strong>",text:`artikel dengan id '${IDARTIKEL}' tidak ditemukan!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)}),200===t.status){let e=t.data.data;e.kategori.replace(/\s/g,"-");$("#idartikel").val(e.id),document.querySelector("#preview-thumbnail").src=e.thumbnail,$("#title").val(e.title),$("#kategori-berita-wraper").val(e.id_kategori),$(`#table-kategori-berita span#${e.id_kategori}`).addClass("d-none"),$(".ql-editor").html(e.content)}};$("#formCrudArticle").on("submit",async t=>{if(t.preventDefault(),validateCrudArtikel()){let e="",a=new FormData(t.target);""!==fileThumbnail&&a.set("thumbnail",fileThumbnail,fileThumbnail.name),a.append("content",$(".ql-editor").html()),showLoadingSpinner(),""!==IDARTIKEL?(""!==fileThumbnail&&a.set("new_thumbnail",fileThumbnail,fileThumbnail.name),e=await httpRequestPut(`${APIURL}/artikel/editartikel`,a)):(a.set("thumbnail",fileThumbnail,fileThumbnail.name),e=await httpRequestPost(`${APIURL}/artikel/addartikel`,a)),hideLoadingSpinner(),201===e.status?(localStorage.removeItem("artikel-content"),setTimeout(()=>{Swal.fire({icon:"success",title:"<strong>SUCCESS</strong>",html:`artikel berhasil ${""==IDARTIKEL?"dipublish":"diedit"}!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)})},300)):400===e.status&&e.message.title&&($("#title").addClass("is-invalid"),$("#title-error").text(e.message.title))}});let dataTemporaryContent=JSON.parse(localStorage.getItem("add-artikel"));"tambah artikel"===pageTitle1&&($("#formCrudArticle #title").on("keyup",t=>{saveTemporaryContent()}),$("#formCrudArticle #kategori-berita-wraper").on("change",t=>{saveTemporaryContent()}),$(".ql-editor").on("keyup",t=>{saveTemporaryContent()}));let fileThumbnail="";const changeThumbPreview=t=>{if(!/image/.test(t.files[0].type))return showAlert({message:"<strong>File yang anda upload bukan gambar!</strong>",autohide:!0,type:"danger"}),t.value="",!1;{const i=500,l=308,r="image/webp",n=.9,s=t.files[0],o=URL.createObjectURL(s),d=new Image;function e(t,e,a){let i=t.width,l=t.height;return i>l?i>e&&(l=Math.round(l*e/i),i=e):l>a&&(i=Math.round(i*a/l),l=a),[i,l]}function a(t,e){for(var a=t.split(","),i=a[0].match(/:(.*?);/)[1],l=atob(a[1]),r=l.length,n=new Uint8Array(r);r--;)n[r]=l.charCodeAt(r);return new File([n],e,{type:i})}$("#thumbnail-spinner").removeClass("d-none"),d.src=o,d.onload=function(){if(t.files[0].size<2e6)fileThumbnail=t.files[0],document.querySelector("#preview-thumbnail").src=o;else{URL.revokeObjectURL(this.src);const[t,s]=e(d,i,l),o=document.createElement("canvas");o.width=t,o.height=s;const m=o.getContext("2d");m.drawImage(d,0,0,t,s),o.toBlob(t=>{},r,n),document.querySelector("#preview-thumbnail").src=o.toDataURL(),fileThumbnail=a(o.toDataURL(),"thumbnail.webp")}$("#thumbnail-spinner").addClass("d-none")}}},hapusArtikel=t=>{Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:e=>{let a=new FormData;return a.append("hashedpass",PASSADMIN),a.append("password",e),axios.post(`${APIURL}/admin/confirmdelete`,a,{headers:{}}).then(e=>httpRequestDelete(`${APIURL}/artikel/deleteartikel?id=${t}`).then(t=>{201==t.status&&getAllBerita()})).catch(t=>{404==t.response.status?Swal.showValidationMessage("password salah"):500==t.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})};