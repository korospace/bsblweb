function validateAddKategori(){let t=!0;return""==$("input#NewKategoriArtikel").val()?(showAlert({message:"<strong>Masukan kategori baru !</strong>",btnclose:!0,type:"danger"}),t=!1):$("input#NewKategoriArtikel").val().length>20&&(showAlert({message:"<strong>Kategori baru maximal 20 huruf !</strong>",btnclose:!0,type:"danger"}),t=!1),arrayKatBerita.forEach(e=>{e.name.toLowerCase()==$("input#NewKategoriArtikel").val().toLowerCase().trim()&&(showAlert({message:"<strong>Kategori sudah tersedia !</strong>",btnclose:!0,type:"danger"}),t=!1)}),t}function validateCrudArtikel(){let t=!0;return $(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),""==IDARTIKEL&&""==$("#thumbnail").val()&&($("#thumbnail").addClass("is-invalid"),t=!1),""==$("#title").val()?($("#title").addClass("is-invalid"),t=!1):$("#title").val().length>250&&($("#title").addClass("is-invalid"),$("#title-error").html("*maximal 250 character"),t=!1),""==$("#kategori-berita-wraper").val()&&($("#kategori-berita-wraper").addClass("is-invalid"),t=!1),t}if("tambah artikel"===pageTitle||"edit artikel"===pageTitle){Quill.register("modules/imageCompressor",imageCompressor);var quill=new Quill("#editor-container",{modules:{imageResize:{displaySize:!0},imageCompressor:{quality:.8,imageType:"image/jpeg",debug:!0},formula:!0,syntax:!0,toolbar:"#toolbar-container"},theme:"snow"})}let arrayBerita=[];const getAllBerita=async()=>{$("#search-artikel").val(""),$("#list-artikel-notfound").addClass("d-none"),$("#container-list-artikel").addClass("d-none"),$("#list-artikel-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/berita_acara/getitem`);if($("#container-list-artikel").removeClass("d-none"),$("#list-artikel-spinner").addClass("d-none"),404===t.status)$("#list-artikel-notfound").removeClass("d-none"),$("#list-artikel-notfound #text-notfound").html("artikel belum ditambah");else if(200===t.status){let e="",a=t.data.data;arrayBerita=a,a.forEach(t=>{let a=new Date(1e3*parseInt(t.created_at)),i=a.toLocaleString("en-US",{day:"numeric"}),n=a.toLocaleString("en-US",{month:"long"}),s=a.toLocaleString("en-US",{year:"numeric"});e+=`<div class="col-12 col-sm-6 col-lg-4 mb-4" style="min-height: 100%;">\n                <div class="card" style="border: 0.5px solid #D2D6DA;min-height: 100%;">\n                    <div class="position-relative">\n                        <img class="card-img-top border-radius-0 position-absolute" style="z-index: 10;min-width: 100%;max-width: 100%;max-height: 100%;;min-height: 100%;" src="${t.thumbnail}" style="opacity: 0;">\n                        <img class="card-img-top border-radius-0" src="${BASEURL}/assets/images/default-thumbnail.jpg" style="opacity: 0;">\n                    </div>\n                    <div class="card-body pb-0 d-flex flex-column justify-content-between" style="font-family: 'qc-semibold';">\n                        <div class="row">\n                            <h4 class="card-title text-capitalize" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">${t.title}</h4>\n                            <h6 class="card-subtitle mb-2 text-muted text-sm">\n                                <i class="fas fa-list-ul mr-1 text-muted text-xs"></i>\n                                ${t.kategori}\n                            </h6>\n                            <h6 class="card-subtitle mb-2 text-muted text-sm">\n                                <i class="far fa-clock mr-1 text-muted text-xs"></i>\n                                ${n}, ${i}, ${s}\n                            </h6>\n                        </div>\n                        <div class="row">\n                            <div class="col-6">\n                                <a href="${BASEURL}/admin/editartikel/${t.id}" class="w-100 btn btn-warning p-2 border-radius-sm" style="height: 34px;">\n                                    <i class="far fa-edit"></i>\n                                </a>\n                            </div>\n                            <div class="col-6">\n                                <span class="w-100 btn btn-danger p-2 border-radius-sm" style="height: 34px;" onclick="hapusArtikel(this,'${t.id}');">\n                                    <i class="fas fa-trash text-white"></i>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`}),$("#container-list-artikel").html(e)}};$("#search-artikel").on("keyup",function(){let t="",e=[];e=""===$(this).val()?arrayBerita:arrayBerita.filter(t=>t.title.includes($(this).val())||t.kategori.includes($(this).val())),0==e.length?($("#list-artikel-notfound").removeClass("d-none"),$("#list-artikel-notfound #text-notfound").html("artikel tidak ditemukan")):($("#list-artikel-notfound").addClass("d-none"),$("#list-artikel-notfound #text-notfound").html(" "),e.forEach(e=>{let a=new Date(1e3*parseInt(e.created_at)),i=a.toLocaleString("en-US",{day:"numeric"}),n=a.toLocaleString("en-US",{month:"long"}),s=a.toLocaleString("en-US",{year:"numeric"});t+=`<div class="col-12 col-sm-6 col-lg-4" style="min-height: 100%;">\n            <div class="card mb-3" style="border: 0.5px solid #D2D6DA;min-height: 100%;">\n                <div class="position-relative">\n                    <img class="card-img-top border-radius-0 position-absolute" style="z-index: 10;min-width: 100%;max-width: 100%;max-height: 100%;;min-height: 100%;" src="${e.thumbnail}" style="opacity: 0;">\n                    <img class="card-img-top border-radius-0" src="${BASEURL}/assets/images/default-thumbnail.jpg" style="opacity: 0;">\n                </div>\n                <div class="card-body pb-0 d-flex flex-column justify-content-between" style="font-family: 'qc-semibold';">\n                    <div class="row">\n                        <h4 class="card-title text-capitalize" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">${e.title}</h4>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="fas fa-list-ul mr-1 text-muted text-xs"></i>\n                            ${e.kategori}\n                        </h6>\n                        <h6 class="card-subtitle mb-2 text-muted text-sm">\n                            <i class="far fa-clock mr-1 text-muted text-xs"></i>\n                            ${n}, ${i}, ${s}\n                        </h6>\n                    </div>\n                    <div class="row">\n                        <div class="col-6">\n                            <a href="${BASEURL}/admin/editartikel/${e.id}" class="w-100 btn btn-warning p-2 border-radius-sm" style="height: 34px;">\n                                <i class="far fa-edit"></i>\n                            </a>\n                        </div>\n                        <div class="col-6">\n                            <span class="w-100 btn btn-danger p-2 border-radius-sm" style="height: 34px;" onclick="hapusArtikel(this,'${e.id}');">\n                                <i class="fas fa-trash text-white"></i>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`})),$("#container-list-artikel").html(t)});const getDetailBerita=async()=>{showLoadingSpinner();let t=await httpRequestGet(`${APIURL}/berita_acara/getitem?id=${IDARTIKEL}`);if(hideLoadingSpinner(),404==t.status&&Swal.fire({icon:"error",title:"<strong>NOT FOUND</strong>",text:`artikel dengan id '${IDARTIKEL}' tidak ditemukan!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)}),200===t.status){let e=t.data.data,a=e.kategori.replace(/\s/g,"-");$("#idartikel").val(e.id),document.querySelector("#preview-thumbnail").src=e.thumbnail,$("#title").val(e.title),$(`#${a}`).attr("selected","selected"),$(".ql-editor").html(e.content)}};let arrayKatBerita=[];const getAllKatBerita=async()=>{$("#list-kategori-spinner").removeClass("d-none"),$("#table-kategori-berita tbody").addClass("d-none");let t=await httpRequestGet(`${APIURL}/kategori_berita/getitem`);$("#list-kategori-spinner").addClass("d-none"),$("#table-kategori-berita tbody").removeClass("d-none");let e="<option value='' selected>-- pilih kategori --</option>";if(404==t.status&&$("#list-kategori-notfound").removeClass("d-none"),200===t.status){let a="",i=t.data.data;arrayKatBerita=t.data.data,i.forEach((t,i)=>{let n=t.name.replace(/\s/g,"-");e+=`<option id="${n}" value="${t.name}">${t.name}</option>`,a+=`<tr class="text-xs">\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold"> ${++i} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span class="font-weight-bold"> ${t.name} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusKategori(this,'${t.id}','${t.name}')">hapus</span>\n                 </td>\n             </tr>`}),$("#table-kategori-berita tbody").html(a)}$("#kategori-berita-wraper").html(e)};getAllKatBerita(),$("#formAddKategoriBerita").on("submit",async function(t){if(t.preventDefault(),validateAddKategori()){let t=new FormData;t.append("kategori_name",$("input#NewKategoriArtikel").val().trim().toLowerCase()),$("#btnAddKategoriBerita #text").addClass("d-none"),$("#btnAddKategoriBerita #spinner").removeClass("d-none");let e=await httpRequestPost(`${APIURL}/kategori_berita/additem`,t);$("#btnAddKategoriBerita #text").removeClass("d-none"),$("#btnAddKategoriBerita #spinner").addClass("d-none"),201===e.status&&($("input#NewKategoriArtikel").val(""),getAllKatBerita(),showAlert({message:"<strong>Success...</strong> kategori berhasil ditambah!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3))}}),$("#formCrudArticle").on("submit",async t=>{if(t.preventDefault(),validateCrudArtikel()){let e="",a=new FormData(t.target);""!==fileThumbnail&&a.set("thumbnail",fileThumbnail,fileThumbnail.name),a.append("content",$(".ql-editor").html()),console.log(a.get("thumbnail")),showLoadingSpinner(),""!==IDARTIKEL?(""!==fileThumbnail&&a.set("new_thumbnail",fileThumbnail,fileThumbnail.name),e=await httpRequestPut(`${APIURL}/berita_acara/edititem`,a)):(a.set("thumbnail",fileThumbnail,fileThumbnail.name),e=await httpRequestPost(`${APIURL}/berita_acara/additem`,a)),hideLoadingSpinner(),201===e.status?setTimeout(()=>{Swal.fire({icon:"success",title:"<strong>SUCCESS</strong>",html:`artikel berhasil ${""==IDARTIKEL?"dipublish":"diedit"}!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)})},300):400===e.status&&e.message.title&&($("#title").addClass("is-invalid"),$("#title-error").text(e.message.title))}});let fileThumbnail="";const changeThumbPreview=t=>{if(!/image/.test(t.files[0].type))return showAlert({message:"<strong>File yang anda upload bukan gambar!</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),t.value="",!1;{const i=320,n=180,s="image/webp",l=.8,r=t.files[0],o=URL.createObjectURL(r),d=new Image;function e(t,e,a){let i=t.width,n=t.height;return i>n?i>e&&(n=Math.round(n*e/i),i=e):n>a&&(i=Math.round(i*a/n),n=a),[i,n]}function a(t,e){for(var a=t.split(","),i=a[0].match(/:(.*?);/)[1],n=atob(a[1]),s=n.length,l=new Uint8Array(s);s--;)l[s]=n.charCodeAt(s);return new File([l],e,{type:i})}document.querySelector("#preview-thumbnail").src="",$("#thumbnail-spinner").removeClass("d-none"),d.src=o,d.onerror=function(){$("#thumbnail-spinner").addClass("d-none"),URL.revokeObjectURL(this.src),showAlert({message:"<strong>Ups terjadi kesalahan, coba sekali lagi!</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3)},d.onload=function(){URL.revokeObjectURL(this.src);const[r,o]=e(d,i,n),m=document.createElement("canvas");m.width=r,m.height=o;const c=m.getContext("2d");if(c.drawImage(d,0,0,r,o),m.toBlob(t=>{},s,l),fileThumbnail=a(m.toDataURL(),"thumbnail.webp"),console.log(fileThumbnail.size),fileThumbnail.size>2e5)return showAlert({message:"<strong>Ukuran file anda terlalu besar!</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),t.value="",!1;document.querySelector("#preview-thumbnail").src=m.toDataURL(),$("#thumbnail-spinner").addClass("d-none")}}},hapusKategori=(t,e,a)=>{Swal.fire({title:"ANDA YAKIN?",text:`semua berita dengan kategori '${a}' akan ikut terhapus`,icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(i=>{i.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:i=>{let n=new FormData;return n.append("hashedpass",PASSADMIN),n.append("password",i),axios.post(`${APIURL}/admin/confirmdelete`,n,{headers:{}}).then(i=>httpRequestDelete(`${APIURL}/kategori_berita/deleteitem?id=${e}`).then(e=>{201==e.status&&(t.parentElement.parentElement.remove(),document.querySelector(`#kategori-berita-wraper option#${a.replace(/\s/g,"-")}`).remove())})).catch(t=>{404==t.response.status?Swal.showValidationMessage("password salah"):500==t.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},hapusArtikel=(t,e)=>{Swal.fire({title:"ANDA YAKIN?",text:"Data akan terhapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(a=>{a.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:a=>{let i=new FormData;return i.append("hashedpass",PASSADMIN),i.append("password",a),axios.post(`${APIURL}/admin/confirmdelete`,i,{headers:{}}).then(a=>httpRequestDelete(`${APIURL}/berita_acara/deleteitem?id=${e}`).then(a=>{201==a.status&&(t.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),arrayBerita=arrayBerita.filter(t=>t.id!=e),0==arrayBerita.length&&($("#list-artikel-notfound").removeClass("d-none"),$("#list-artikel-notfound #text-notfound").html("artikel belum ditambah")))})).catch(t=>{404==t.response.status?Swal.showValidationMessage("password salah"):500==t.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})};