function validateAddKategori(){let a=!0;return""==$("input#NewkategoriSampah").val()?(showAlert({message:"<strong>Masukan kategori baru !</strong>",btnclose:!0,type:"danger"}),a=!1):$("input#NewkategoriSampah").val().length>20&&(showAlert({message:"<strong>Kategori baru maximal 20 huruf !</strong>",btnclose:!0,type:"danger"}),a=!1),arrayKatSampah.forEach(t=>{t.name.toLowerCase()==$("input#NewkategoriSampah").val().toLowerCase().trim()&&(showAlert({message:"<strong>Kategori sudah tersedia !</strong>",btnclose:!0,type:"danger"}),a=!1)}),a}const getTotalSampah=async()=>{let a=await httpRequestGet(`${APIURL}/sampah/totalitem`);if(200===a.status){let t=a.data.data;for(const a in t)$(`#sampah-${a}`).html(t[a].total+" Kg")}};let arrayKatSampah=[];const getAllKatSampah=async()=>{$("#kategori-sampah-wraper").html(`<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n       <img src="${BASEURL}/assets/images/spinner.svg" style="width: 20px;" />\n   </div>`);let a=await httpRequestGet(`${APIURL}/kategori_sampah/getitem`);if(404===a.status)$("#kategori-sampah-wraper").html('<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n           <h6 tyle="opacity: 0.6;">kategori belum tersedia</h6>\n       </div>');else if(200===a.status){let t="",e=a.data.data;arrayKatSampah=a.data.data,e.forEach(a=>{let e=a.name.replace(/\s/g,"-");t+=`\n           <div class="w-100">\n               <div id="${e}" class="kategori-list w-100 d-flex justify-content-between align-items-center px-3 py-2 cursor-pointer">\n                   <div class="d-flex align-items-center text-md" onclick="changeKatSampahVal(this,'${a.name}')" style="flex: 1;">\n                       ${a.name} <i class="checklist fas fa-check-circle text-muted ml-2"></i>\n                   </div>\n                   <span class="add-item badge badge-danger border-radius-sm cursor-pointer"  onclick="hapusKatSampahVal(this,'${a.id}','${a.name}')">\n                       <i class="fas fa-trash text-white"></i>\n                   </span>\n               </div>\n               <hr class="horizontal dark mt-0">\n            </div>`}),$("#kategori-sampah-wraper").html(t)}},changeKatSampahVal=(a,t)=>{$(".kategori-list").removeClass("active"),$("#formAddEditSampah input[name=kategori]").val(t),a.parentElement.classList.add("active")};$("#btnAddKategoriSampah").on("click",async function(a){if(a.preventDefault(),validateAddKategori()){let a=new FormData;a.append("kategori_name",$("input#NewkategoriSampah").val().trim().toLowerCase()),$("#btnAddKategoriSampah #text").addClass("d-none"),$("#btnAddKategoriSampah #spinner").removeClass("d-none");let t=await httpRequestPost(`${APIURL}/kategori_sampah/additem`,a);$("#btnAddKategoriSampah #text").removeClass("d-none"),$("#btnAddKategoriSampah #spinner").addClass("d-none"),201===t.status&&($("input#NewkategoriSampah").val(""),getAllKatSampah(),showAlert({message:"<strong>Success...</strong> kategori berhasil ditambah!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3))}});let arrayJenisSampah=[];const getAllJenisSampah=async()=>{$("#search-sampah").val(""),$("#list-sampah-notfound").addClass("d-none"),$("#table-jenis-sampah").addClass("d-none"),$("#list-sampah-spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/sampah/getitem`);if($("#table-jenis-sampah").removeClass("d-none"),$("#list-sampah-spinner").addClass("d-none"),404===a.status)$("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("jenis sampah belum ditambah");else if(200===a.status){let t="",e=sortingSampah(a.data.data);arrayJenisSampah=e,e.forEach((a,e)=>{t+=`<tr class="text-xs">\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold"> ${++e} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span class="font-weight-bold"> ${a.kategori} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                    ${a.jenis}\n                 </td>\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold">Rp. ${modifUang(a.harga)} </span>\n                 </td>\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold"> ${a.jumlah} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusSampah(this,'${a.id}')">hapus</span>\n                     <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditSampah" onclick="openModalAddEditSmp('editasampah','${a.id}')">edit</span>\n                 </td>\n             </tr>`}),$("#table-jenis-sampah tbody").html(t)}},sortingSampah=a=>{let t=[],e={},s=[];a.forEach(a=>{t.includes(a.kategori)||t.push(a.kategori.replace(/\s/g,"_"))}),t.forEach(t=>{e[t]=a.filter(a=>a.kategori==t.replace(/_/g," "))});for(let a in e)e[a].forEach(a=>{s.push(a)});return s};$("#search-sampah").on("keyup",function(){let a="",t=[];t=""===$(this).val()?arrayJenisSampah:arrayJenisSampah.filter(a=>a.kategori.includes($(this).val())||a.jenis.includes($(this).val())),0==t.length?($("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("sampah tidak ditemukan")):($("#list-sampah-notfound").addClass("d-none"),$("#list-sampah-notfound #text-notfound").html(" "),t.forEach((t,e)=>{a+=`<tr class="text-xs">\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${++e} </span>\n            </td>\n            <td class="align-middle text-center">\n                <span class="font-weight-bold"> ${t.kategori} </span>\n            </td>\n            <td class="align-middle text-center">\n               ${t.jenis}\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold">Rp. ${modifUang(t.harga)} </span>\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${t.jumlah} </span>\n            </td>\n            <td class="align-middle text-center">\n                <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusSampah(this,'${t.id}')">hapus</span>\n                <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditSampah" onclick="openModalAddEditSmp('editasampah','${t.id}')">edit</span>\n            </td>\n        </tr>`})),$("#table-jenis-sampah tbody").html(a)});const clearInputForm=()=>{$("#formAddEditSampah .form-control").val("")},openModalAddEditSmp=(a,t=null)=>{let e="addsampah"==a?"tambah sampah":"edit sampah";if($("#modalAddEditSampah .modal-title").html(e),$("#formAddEditSampah .form-control").removeClass("is-invalid"),$("#formAddEditSampah .text-danger").html(""),$(".kategori-list").removeClass("active"),"addsampah"==a)$("#formAddEditSampah").attr("onsubmit","addSampah(this,event);"),$("#modalAddEditSampah .edit-item").addClass("d-none"),$("#modalAddEditSampah .add-item").removeClass("d-none"),clearInputForm();else{$("#formAddEditSampah").attr("onsubmit","editSampah(this,event);"),$("#modalAddEditSampah .edit-item").removeClass("d-none"),$("#modalAddEditSampah .add-item").addClass("d-none");let a=arrayJenisSampah.filter(a=>a.id==t);$("#formAddEditSampah #id").val(a[0].id),$("#formAddEditSampah #jenis").val(a[0].jenis),$("#formAddEditSampah #harga").val(a[0].harga),$("#formAddEditSampah #jumlah").val(a[0].jumlah),$("#formAddEditSampah #kategori").val(a[0].kategori);let e=a[0].kategori.replace(/\s/g,"-");$(`#kategori-sampah-wraper #${e}`).addClass("active"),currentKategori=a[0].kategori}},addSampah=async(a,t)=>{if(t.preventDefault(),doValidateAddSmp()){let t=new FormData(a);t.set("kategori",$("#formAddEditSampah input#kategori").val()),$("#formAddEditSampah #btn-add-edit-sampah #text").addClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").removeClass("d-none");let e=await httpRequestPost(`${APIURL}/sampah/additem`,t);$("#formAddEditSampah #btn-add-edit-sampah #text").removeClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").addClass("d-none"),201===e.status?($(".kategori-list").removeClass("active"),getAllJenisSampah(),clearInputForm(),showAlert({message:"<strong>Success...</strong> sampah berhasil ditambah!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)):400===e.status&&e.message.jenis&&($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").text(e.message.jenis))}},editSampah=async(a,t)=>{if(t.preventDefault(),doValidateAddSmp()){let t=new FormData(a);t.set("kategori",$("#formAddEditSampah input#kategori").val()),$("#formAddEditSampah #btn-add-edit-sampah #text").addClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").removeClass("d-none");let e=await httpRequestPut(`${APIURL}/sampah/edititem`,t);$("#formAddEditSampah #btn-add-edit-sampah #text").removeClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").addClass("d-none"),201===e.status?(getAllJenisSampah(),showAlert({message:"<strong>Success...</strong> sampah berhasil diubah!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)):400===e.status&&e.message.jenis&&($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").text(e.message.jenis))}},hapusKatSampahVal=(a,t,e)=>{Swal.fire({title:"ANDA YAKIN?",text:`semua sampah dengan kategori '${e}' akan ikut terhapus`,icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(s=>{s.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:s=>{let d=new FormData;return d.append("hashedpass",PASSADMIN),d.append("password",s),axios.post(`${APIURL}/admin/confirmdelete`,d,{headers:{}}).then(s=>($("#formAddEditSampah input[name=kategori]").val()==e&&$("#formAddEditSampah input[name=kategori]").val(""),httpRequestDelete(`${APIURL}/kategori_sampah/deleteitem?id=${t}`).then(e=>{201==e.status&&(a.parentElement.parentElement.remove(),arrayKatSampah=arrayKatSampah.filter(a=>a.id!=t),getAllJenisSampah())}))).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},hapusSampah=(a,t)=>{Swal.fire({title:"ANDA YAKIN?",text:"Data akan terhapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(e=>{e.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:e=>{let s=new FormData;return s.append("hashedpass",PASSADMIN),s.append("password",e),axios.post(`${APIURL}/admin/confirmdelete`,s,{headers:{}}).then(e=>httpRequestDelete(`${APIURL}/sampah/deleteitem?id=${t}`).then(e=>{201==e.status&&(a.parentElement.parentElement.remove(),arrayJenisSampah=arrayJenisSampah.filter(a=>a.id!=t),0==arrayJenisSampah.length&&($("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("sampah belum ditambah")))})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},doValidateAddSmp=()=>{let a=!0;return $(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),""==$("#formAddEditSampah #jenis").val()?($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").html("*jenis harus di isi"),a=!1):$("#formAddEditSampah #jenis").val().length>40&&($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").html("*maksimal 40 huruf"),a=!1),""==$("#formAddEditSampah #harga").val()?($("#formAddEditSampah #harga").addClass("is-invalid"),$("#formAddEditSampah #harga-error").html("*harga harus di isi"),a=!1):$("#formAddEditSampah #harga").val().length>11?($("#formAddEditSampah #harga").addClass("is-invalid"),$("#formAddEditSampah #harga-error").html("*maksimal 11 angka"),a=!1):/^\d+$/.test($("#formAddEditSampah #harga").val())||($("#formAddEditNasabah #harga").addClass("is-invalid"),$("#formAddEditNasabah #harga-error").html("*hanya boleh angka"),a=!1),$("#formAddEditSampah .edit-item").hasClass("d-none")||(""==$("#formAddEditSampah #jumlah").val()?($("#formAddEditSampah #jumlah").addClass("is-invalid"),$("#formAddEditSampah #jumlah-error").html("*jumlah harus di isi"),a=!1):$("#formAddEditSampah #jumlah").val().length>11?($("#formAddEditSampah #jumlah").addClass("is-invalid"),$("#formAddEditSampah #jumlah-error").html("*maksimal 11 angka"),a=!1):/[^0-9\.]/g.test($("#formAddEditSampah #jumlah").val())&&($("#formAddEditSampah #jumlah").addClass("is-invalid"),$("#formAddEditSampah #jumlah-error").html("*hanya boleh angka"),a=!1)),""==$("#formAddEditSampah #kategori").val()&&($("#formAddEditSampah #kategori").addClass("is-invalid"),a=!1),a};