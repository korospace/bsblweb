let arrayAdmin=[];const getAllAdmin=async()=>{$("#search-admin").val(""),$("#list-admin-notfound").addClass("d-none"),$("#table-admin").addClass("d-none"),$("#list-admin-spinner").removeClass("d-none");let d=await httpRequestGet(`${APIURL}/admin/getadmin`);if($("#table-admin").removeClass("d-none"),$("#list-admin-spinner").addClass("d-none"),404===d.status)$("#list-admin-notfound").removeClass("d-none"),$("#list-admin-notfound #text-notfound").html("belum ada admin lain");else if(200===d.status){let a="",i=d.data.data;arrayAdmin=d.data.data,i.forEach((d,i)=>{let n="belum login";if(0!=d.last_active){let a=new Date(1e3*parseInt(d.last_active)),i=a.toLocaleString("en-US",{hour:"numeric",minute:"numeric"}),t=a.toLocaleString("en-US",{day:"numeric"}),e=a.toLocaleString("en-US",{month:"long"}),s=a.toLocaleString("en-US",{year:"numeric"});n=`${t}-${e}-${s} ${i}`}a+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++i} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${d.username} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> ${d.nama_lengkap} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"superadmin"===d.privilege?"text-primary border-primary":"text-info border-info"} pb-1 rounded-sm"> ${d.privilege} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"t"===d.is_active?"text-success border-success":"text-warning border-warning"} pb-1 rounded-sm"> ${"t"===d.is_active?"yes":"no"} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> \n                        ${n}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusAdmin(this,'${d.id}')">hapus</span>\n                    <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditAdmin" onclick="openModalAddEditAdm('editadmin','${d.id}')">edit</span>\n                </td>\n            </tr>`}),$("#table-admin tbody").html(a)}};$("#search-admin").on("keyup",function(){let d="",a=[];a=""===$(this).val()?arrayAdmin:arrayAdmin.filter(d=>d.nama_lengkap.includes($(this).val())||d.username.includes($(this).val())),0==a.length?($("#list-admin-notfound").removeClass("d-none"),$("#list-admin-notfound #text-notfound").html("admin tidak ditemukan")):($("#list-admin-notfound").addClass("d-none"),$("#list-admin-notfound #text-notfound").html(" "),a.forEach((a,i)=>{let n="belum login";if(0!=a.last_active){let d=new Date(1e3*parseInt(a.last_active)),i=d.toLocaleString("en-US",{hour:"numeric",minute:"numeric"}),t=d.toLocaleString("en-US",{day:"numeric"}),e=d.toLocaleString("en-US",{month:"long"}),s=d.toLocaleString("en-US",{year:"numeric"});n=`${t}-${e}-${s} ${i}`}d+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++i} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${a.username} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> ${a.nama_lengkap} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"superadmin"===a.privilege?"text-primary border-primary":"text-info border-info"} pb-1 rounded-sm"> ${a.privilege} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"t"===a.is_active?"text-success border-success":"text-warning border-warning"} pb-1 rounded-sm"> ${"t"===a.is_active?"yes":"no"} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> \n                        ${n}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusAdmin(this,'${a.id}')">hapus</span>\n                    <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditAdmin" onclick="openModalAddEditAdm('editadmin','${a.id}')">edit</span>\n                </td>\n            </tr>`})),$("#table-admin tbody").html(d)});const openModalAddEditAdm=(d,a=null)=>{let i="addadmin"==d?"tambah admin":"edit admin";$("#modalAddEditAdmin .modal-title").html(i),$("#formAddEditAdmin .form-check-input").prop("checked",!1),$("#formAddEditAdmin .form-control").removeClass("is-invalid"),$("#formAddEditAdmin .form-check-input").removeClass("is-invalid"),$("#formAddEditAdmin .text-danger").html(""),"addadmin"==d?($("#modalAddEditAdmin .addadmin-item").removeClass("d-none"),$("#modalAddEditAdmin .editadmin-item").addClass("d-none"),clearInputForm()):($("#modalAddEditAdmin .addadmin-item").addClass("d-none"),$("#modalAddEditAdmin .editadmin-item").removeClass("d-none"),$("#modalAddEditAdmin #list-admin-spinner").removeClass("d-none"),getProfileAdmin(a))},crudAdmin=async(d,a)=>{a.preventDefault();let i=new FormData(d);if(doValidate(i)){let d="",a=$("#modalAddEditAdmin .modal-title").html(),n=i.get("tgl_lahir").split("-"),t=$("#formAddEditAdmin input[name=privilege]").val();i.set("tgl_lahir",`${n[2]}-${n[1]}-${n[0]}`),i.set("privilege",`${"1"==t?"superadmin":"admin"}`),$("#formAddEditAdmin button#submit #text").addClass("d-none"),$("#formAddEditAdmin button#submit #spinner").removeClass("d-none"),"edit admin"==a?(i.set("active",$("#formAddEditAdmin input[name=active]").val()),d=await httpRequestPut(`${APIURL}/admin/editadmin`,i)):d=await httpRequestPost(`${APIURL}/register/admin`,i),$("#formAddEditAdmin button#submit #text").removeClass("d-none"),$("#formAddEditAdmin button#submit #spinner").addClass("d-none"),201===d.status?(getAllAdmin(),"tambah admin"==a&&clearInputForm(),showAlert({message:`<strong>Success...</strong> admin berhasil ${"tambah admin"==a?"ditambah":"diedit"}!`,btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)):400===d.status&&(d.message.username&&($("#formAddEditAdmin #username").addClass("is-invalid"),$("#formAddEditAdmin #username-error").text(d.message.username)),d.message.notelp&&($("#formAddEditAdmin #notelp").addClass("is-invalid"),$("#formAddEditAdmin #notelp-error").text(d.message.notelp)))}},getProfileAdmin=async d=>{let a=await httpRequestGet(`${APIURL}/admin/getadmin?id=${d}`);if($("#modalAddEditAdmin #list-admin-spinner").addClass("d-none"),200===a.status){dataAdmin=a.data.data;for(const d in dataAdmin)$(`#formAddEditAdmin input[name=${d}]`).val(dataAdmin[d]);let d=dataAdmin.tgl_lahir.split("-");$("#formAddEditAdmin input[name=tgl_lahir]").val(`${d[2]}-${d[1]}-${d[0]}`),$(`#formAddEditAdmin input#kelamin-${dataAdmin.kelamin}`).prop("checked",!0),"super"==dataAdmin.privilege?($("#formAddEditAdmin input[name=privilege]").val("1"),$("#formAddEditAdmin .toggle-privilege").removeClass("bg-secondary").addClass("active bg-success")):($("#formAddEditAdmin input[name=privilege]").val("0"),$("#formAddEditAdmin .toggle-privilege").removeClass("active bg-success").addClass("bg-secondary")),"t"==dataAdmin.active?($("#formAddEditAdmin input[name=active]").val("1"),$("#formAddEditAdmin .toggle-akunaktif").removeClass("bg-secondary").addClass("active bg-success")):($("#formAddEditAdmin input[name=active]").val("0"),$("#formAddEditAdmin .toggle-akunaktif").removeClass("active bg-success").addClass("bg-secondary")),$("#newpass").val("")}},clearInputForm=()=>{$("#formAddEditAdmin input[name=privilege]").val(""),$(".toggle-privilege").removeClass("active bg-success").addClass("bg-secondary"),$("#formAddEditAdmin .form-control").val("")};$("#formAddEditAdmin .form-check-input").on("click",function(d){$("#formAddEditAdmin input[name=kelamin]").val($(this).val()),$("#formAddEditAdmin .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formAddEditAdmin input[type=checkbox]").on("click",function(d){"1"==$(this).val()?($(this).val("0"),$(this).parent().removeClass("active bg-success").addClass("bg-secondary")):($(this).val("1"),$(this).parent().removeClass("bg-secondary").addClass("active bg-success"))});const hapusAdmin=(d,a)=>{Swal.fire({title:"ANDA YAKIN?",text:"Data akan terhapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(i=>{i.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:i=>{let n=new FormData;return n.append("hashedpass",PASSADMIN),n.append("password",i),axios.post(`${APIURL}/admin/confirmdelete`,n,{headers:{}}).then(i=>httpRequestDelete(`${APIURL}/admin/deleteadmin?id=${a}`).then(i=>{201==i.status&&(d.parentElement.parentElement.remove(),arrayAdmin=arrayAdmin.filter(d=>d.id!=a),0==arrayAdmin.length&&($("#list-admin-notfound").removeClass("d-none"),$("#list-admin-notfound #text-notfound").html("admin belum ditambah")))})).catch(d=>{404==d.response.status?Swal.showValidationMessage("password salah"):500==d.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},doValidate=d=>{let a=!0;return $(".form-control").removeClass("is-invalid"),$(".form-check-input").removeClass("is-invalid"),$(".text-danger").html(""),""==$("#formAddEditAdmin #nama").val()?($("#formAddEditAdmin #nama").addClass("is-invalid"),$("#formAddEditAdmin #nama-error").html("*nama lengkap harus di isi"),a=!1):$("#formAddEditAdmin #nama").val().length>40&&($("#formAddEditAdmin #nama").addClass("is-invalid"),$("#formAddEditAdmin #nama-error").html("*maksimal 40 huruf"),a=!1),""==$("#formAddEditAdmin #username").val()?($("#formAddEditAdmin #username").addClass("is-invalid"),$("#formAddEditAdmin #username-error").html("*username harus di isi"),a=!1):$("#formAddEditAdmin #username").val().length<8||$("#formAddEditAdmin #username").val().length>20?($("#formAddEditAdmin #username").addClass("is-invalid"),$("#formAddEditAdmin #username-error").html("*minimal 8 huruf dan maksimal 20 huruf"),a=!1):/\s/.test($("#formAddEditAdmin #username").val())&&($("#formAddEditAdmin #username").addClass("is-invalid"),$("#formAddEditAdmin #username-error").html("*tidak boleh ada spasi"),a=!1),$("#modalAddEditAdmin .addadmin-item").hasClass("d-none")||(""==$("#formAddEditAdmin #password").val()?($("#formAddEditAdmin #password").addClass("is-invalid"),$("#formAddEditAdmin #password-error").html("*password harus di isi"),a=!1):$("#formAddEditAdmin #password").val().length<8||$("#formAddEditAdmin #password").val().length>20?($("#formAddEditAdmin #password").addClass("is-invalid"),$("#formAddEditAdmin #password-error").html("*minimal 8 huruf dan maksimal 20 huruf"),a=!1):/\s/.test($("#formAddEditAdmin #password").val())&&($("#formAddEditAdmin #password").addClass("is-invalid"),$("#formAddEditAdmin #password-error").html("*tidak boleh ada spasi"),a=!1)),""!==$("#modalAddEditAdmin #newpass").val()&&($("#modalAddEditAdmin #newpass").val().length<8||$("#modalAddEditAdmin #newpass").val().length>20?($("#modalAddEditAdmin #newpass").addClass("is-invalid"),$("#modalAddEditAdmin #newpass-error").html("*minimal 8 huruf dan maksimal 20 huruf"),a=!1):/\s/.test($("#modalAddEditAdmin #newpass").val())&&($("#modalAddEditAdmin #newpass").addClass("is-invalid"),$("#modalAddEditAdmin #newpass-error").html("*tidak boleh ada spasi"),a=!1)),""==$("#formAddEditAdmin #tgllahir").val()&&($("#formAddEditAdmin #tgllahir").addClass("is-invalid"),$("#formAddEditAdmin #tgllahir-error").html("*tgl lahir harus di isi"),a=!1),""==$("#formAddEditAdmin input[name=kelamin]").val()&&($(".form-check-input").addClass("is-invalid"),a=!1),""==$("#formAddEditAdmin #alamat").val()?($("#formAddEditAdmin #alamat").addClass("is-invalid"),$("#formAddEditAdmin #alamat-error").html("*alamat harus di isi"),a=!1):$("#formAddEditAdmin #alamat").val().length>255&&($("#formAddEditAdmin #alamat").addClass("is-invalid"),$("#formAddEditAdmin #alamat-error").html("*maksimal 255 huruf"),a=!1),""==$("#formAddEditAdmin #notelp").val()?($("#formAddEditAdmin #notelp").addClass("is-invalid"),$("#formAddEditAdmin #notelp-error").html("*no.telp harus di isi"),a=!1):$("#formAddEditAdmin #notelp").val().length>14?($("#formAddEditAdmin #notelp").addClass("is-invalid"),$("#formAddEditAdmin #notelp-error").html("*maksimal 14 huruf"),a=!1):/^\d+$/.test($("#formAddEditAdmin #notelp").val())||($("#formAddEditAdmin #notelp").addClass("is-invalid"),$("#formAddEditAdmin #notelp-error").html("*hanya boleh angka"),a=!1),a};