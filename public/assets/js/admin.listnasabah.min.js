let arrayNasabah=[];const getAllNasabah=async()=>{$("#search-nasabah").val(""),$("#list-nasabah-notfound").addClass("d-none"),$("#table-nasabah").addClass("d-none"),$("#list-nasabah-spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/admin/getnasabah`);if($("#table-nasabah").removeClass("d-none"),$("#list-nasabah-spinner").addClass("d-none"),404===a.status)$("#list-nasabah-notfound").removeClass("d-none"),$("#list-nasabah-notfound #text-notfound").html("belum ada nasabah");else if(200===a.status){let d="",s=a.data.data;arrayNasabah=a.data.data,s.forEach((a,s)=>{d+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++s} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${a.id} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> ${a.nama_lengkap} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"t"===a.is_verify?"text-success border-success":"text-warning border-warning"} pb-1 rounded-sm"> ${"t"===a.is_verify?"yes":"no"} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusNasabah(this,'${a.id}')">hapus</span>\n                    <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditNasabah" onclick="openModalAddEditNsb('editasabah','${a.id}')">edit</span>\n                    <a href="${BASEURL}/admin/detilnasabah/${a.id}" id="btn-detil" class="badge badge-info text-xxs pb-1 rounded-sm cursor-pointer">detil</a>\n                    <span id="btn-detil" class="d-none badge badge-info text-xxs pb-1 rounded-sm cursor-pointer" onclick="goToDetilNasabah('${a.id}')">detil</span>\n                </td>\n            </tr>`}),$("#table-nasabah tbody").html(d)}};$("#search-nasabah").on("keyup",function(){let a="",d=[];d=""===$(this).val()?arrayNasabah:arrayNasabah.filter(a=>a.nama_lengkap.includes($(this).val())||a.id.includes($(this).val())),0==d.length?($("#list-nasabah-notfound").removeClass("d-none"),$("#list-nasabah-notfound #text-notfound").html("nasabah tidak ditemukan")):($("#list-nasabah-notfound").addClass("d-none"),$("#list-nasabah-notfound #text-notfound").html(" "),d.forEach((d,s)=>{a+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++s} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${d.id} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> ${d.nama_lengkap} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"t"===d.is_verify?"text-success border-success":"text-warning border-warning"} pb-1 rounded-sm"> ${"t"===d.is_verify?"yes":"no"} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusNasabah(this,'${d.id}')">hapus</span>\n                    <span id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditNasabah" onclick="openModalAddEditNsb('editasabah','${d.id}')">edit</span>\n                    <a href="${BASEURL}/admin/detilnasabah/${d.id}" id="btn-detil" class="badge badge-info text-xxs pb-1 rounded-sm cursor-pointer">detil</a>\n                    <span id="btn-detil" class="d-none badge badge-info text-xxs pb-1 rounded-sm cursor-pointer" onclick="goToDetilNasabah('${d.id}')">detil</span>\n                </td>\n            </tr>`})),$("#table-nasabah tbody").html(a)});const openModalAddEditNsb=(a,d=null)=>{let s="addnasabah"==a?"tambah nasabah":"edit nasabah";$("#modalAddEditNasabah .modal-title").html(s),$("#formAddEditNasabah .form-check-input").prop("checked",!1),$("#formAddEditNasabah .form-control").removeClass("is-invalid"),$("#formAddEditNasabah .form-check-input").removeClass("is-invalid"),$("#formAddEditNasabah .text-danger").html(""),"addnasabah"==a?($("#modalAddEditNasabah .addnasabah-item").removeClass("d-none"),$("#modalAddEditNasabah .editnasabah-item").addClass("d-none"),clearInputForm()):($("#modalAddEditNasabah .addnasabah-item").addClass("d-none"),$("#modalAddEditNasabah .editnasabah-item").removeClass("d-none"),$("#modalAddEditNasabah #list-nasabah-spinner").removeClass("d-none"),getProfileNasabah(d))},crudNasabah=async(a,d)=>{d.preventDefault();let s=new FormData(a);if(doValidate(s)){let a="",d=$("#modalAddEditNasabah .modal-title").html(),t=s.get("tgl_lahir").split("-");s.set("tgl_lahir",`${t[2]}-${t[1]}-${t[0]}`),$("#formAddEditNasabah button#submit #text").addClass("d-none"),$("#formAddEditNasabah button#submit #spinner").removeClass("d-none"),"edit nasabah"==d?(s.set("is_verify",$("#formAddEditNasabah input[name=is_verify]").val()),a=await httpRequestPut(`${APIURL}/admin/editnasabah`,s)):a=await httpRequestPost(`${APIURL}/admin/addnasabah`,s),$("#formAddEditNasabah button#submit #text").removeClass("d-none"),$("#formAddEditNasabah button#submit #spinner").addClass("d-none"),201===a.status?(getAllNasabah(),"tambah nasabah"==d&&clearInputForm(),showAlert({message:`<strong>Success...</strong> nasabah berhasil ${"tambah nasabah"==d?"ditambah":"diedit"}!`,btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)):400===a.status&&(a.message.email&&($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").text(a.message.email)),a.message.username&&($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").text(a.message.username)),a.message.notelp&&($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").text(a.message.notelp)))}},getProfileNasabah=async a=>{let d=await httpRequestGet(`${APIURL}/admin/getnasabah?id=${a}`);if($("#modalAddEditNasabah #list-nasabah-spinner").addClass("d-none"),200===d.status){dataNasabah=d.data.data;for(const a in dataNasabah)$(`#formAddEditNasabah input[name=${a}]`).val(dataNasabah[a]);let a=dataNasabah.tgl_lahir.split("-");$("#formAddEditNasabah input[name=tgl_lahir]").val(`${a[2]}-${a[1]}-${a[0]}`),$(`#formAddEditNasabah input#kelamin-${dataNasabah.kelamin}`).prop("checked",!0),"t"==dataNasabah.is_verify?($("#formAddEditNasabah input[name=is_verify]").val("1"),$("#formAddEditNasabah #btn-toggle").removeClass("bg-secondary").addClass("active bg-success")):($("#formAddEditNasabah input[name=is_verify]").val("0"),$("#formAddEditNasabah #btn-toggle").removeClass("active bg-success").addClass("bg-secondary")),$("#newpass").val("")}},editNasabah=(a,d)=>{d.preventDefault();let s=new FormData(a);if(doValidate(s)){$("#formAddEditNasabah button#submit #text").addClass("d-none"),$("#formAddEditNasabah button#submit #spinner").removeClass("d-none");let a=s.get("tgl_lahir").split("-");for(var t of(s.set("tgl_lahir",`${a[2]}-${a[1]}-${a[0]}`),s.set("is_verify",$("#formAddEditNasabah input[name=is_verify]").val()),""==s.get("new_password")&&s.delete("new_password"),s.entries()))console.log(t[0],t[1]);axios.put(`${APIURL}/admin/editnasabah`,s,{headers:{token:TOKEN}}).then(a=>{$("#formAddEditNasabah button#submit #text").removeClass("d-none"),$("#formAddEditNasabah button#submit #spinner").addClass("d-none"),getAllNasabah(),$("#newpass-edit").val(""),showAlert({message:"<strong>Success...</strong> edit profile berhasil!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)}).catch(a=>{$("#formAddEditNasabah button#submit #text").removeClass("d-none"),$("#formAddEditNasabah button#submit #spinner").addClass("d-none"),400==a.response.status?(a.response.data.messages.username&&($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").text(a.response.data.messages.username)),a.response.data.messages.notelp&&($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").text(a.response.data.messages.notelp))):showAlert({message:"<strong>Ups . . .</strong> terjadi kesalahan pada server, coba sekali lagi",btnclose:!0,type:"danger"})})}},clearInputForm=()=>{$("#formAddEditNasabah .form-control").val("")};$("#formAddEditNasabah .form-check-input").on("click",function(a){$("#formAddEditNasabah input[name=kelamin]").val($(this).val()),$("#formAddEditNasabah .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formAddEditNasabah input[name=is_verify]").on("click",function(a){"1"==$(this).val()?($(this).val("0"),$(this).parent().removeClass("active bg-success").addClass("bg-secondary")):($(this).val("1"),$(this).parent().removeClass("bg-secondary").addClass("active bg-success"))});const doValidate=a=>{let d=!0,s=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return $(".form-control").removeClass("is-invalid"),$(".form-check-input").removeClass("is-invalid"),$(".text-danger").html(""),""==$("#formAddEditNasabah #nama").val()?($("#formAddEditNasabah #nama").addClass("is-invalid"),$("#formAddEditNasabah #nama-error").html("*nama lengkap harus di isi"),d=!1):$("#formAddEditNasabah #nama").val().length>40&&($("#formAddEditNasabah #nama").addClass("is-invalid"),$("#formAddEditNasabah #nama-error").html("*maksimal 40 huruf"),d=!1),""==$("#formAddEditNasabah #username").val()?($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*username harus di isi"),d=!1):$("#formAddEditNasabah #username").val().length<8||$("#formAddEditNasabah #username").val().length>20?($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*minimal 8 huruf dan maksimal 20 huruf"),d=!1):/\s/.test($("#formAddEditNasabah #username").val())&&($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*tidak boleh ada spasi"),d=!1),$("#modalAddEditNasabah .addnasabah-item").hasClass("d-none")||(""==$("#formAddEditNasabah #email").val()?($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").html("*email harus di isi"),d=!1):$("#formAddEditNasabah #email").val().length>40?($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").html("*maksimal 40 huruf"),d=!1):s.test(String($("#formAddEditNasabah #email").val()).toLowerCase())||($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").html("*email tidak valid"),d=!1),""==$("#formAddEditNasabah #password").val()?($("#formAddEditNasabah #password").addClass("is-invalid"),$("#formAddEditNasabah #password-error").html("*password harus di isi"),d=!1):$("#formAddEditNasabah #password").val().length<8||$("#formAddEditNasabah #password").val().length>20?($("#formAddEditNasabah #password").addClass("is-invalid"),$("#formAddEditNasabah #password-error").html("*minimal 8 huruf dan maksimal 20 huruf"),d=!1):/\s/.test($("#formAddEditNasabah #password").val())&&($("#formAddEditNasabah #password").addClass("is-invalid"),$("#formAddEditNasabah #password-error").html("*tidak boleh ada spasi"),d=!1),""==$("#formAddEditNasabah #rw").val()?($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*rw harus di isi"),d=!1):$("#formAddEditNasabah #rw").val().length<2||$("#formAddEditNasabah #rw").val().length>2?($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*minimal 2 huruf dan maksimal 2 huruf"),d=!1):/^\d+$/.test($("#formAddEditNasabah #rw").val())||($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*hanya boleh angka"),d=!1),""==$("#formAddEditNasabah #rt").val()?($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*rt harus di isi"),d=!1):$("#formAddEditNasabah #rt").val().length<2||$("#formAddEditNasabah #rt").val().length>2?($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*minimal 2 huruf dan maksimal 2 huruf"),d=!1):/^\d+$/.test($("#formAddEditNasabah #rt").val())||($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*hanya boleh angka"),d=!1),""==$("#formAddEditNasabah #kodepos").val()?($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*kodepos harus di isi"),d=!1):$("#formAddEditNasabah #kodepos").val().length<5||$("#formAddEditNasabah #kodepos").val().length>5?($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*minimal 5 huruf dan maksimal 5 huruf"),d=!1):/^\d+$/.test($("#formAddEditNasabah #kodepos").val())||($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*hanya boleh angka"),d=!1)),""!==$("#modalAddEditNasabah #newpass").val()&&($("#modalAddEditNasabah #newpass").val().length<8||$("#modalAddEditNasabah #newpass").val().length>20?($("#modalAddEditNasabah #newpass").addClass("is-invalid"),$("#modalAddEditNasabah #newpass-error").html("*minimal 8 huruf dan maksimal 20 huruf"),d=!1):/\s/.test($("#modalAddEditNasabah #newpass").val())&&($("#modalAddEditNasabah #newpass").addClass("is-invalid"),$("#modalAddEditNasabah #newpass-error").html("*tidak boleh ada spasi"),d=!1)),""==$("#formAddEditNasabah #saldo_uang").val()?($("#formAddEditNasabah #saldo_uang").addClass("is-invalid"),d=!1):/[^0-9\.]/g.test($("#modalAddEditNasabah #saldo_uang").val())&&($("#formAddEditNasabah #saldo_uang").addClass("is-invalid"),showAlert({message:"<strong>Saldo hanya boleh angka dan titik</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),d=!1),""==$("#formAddEditNasabah #saldo_antam").val()?($("#formAddEditNasabah #saldo_antam").addClass("is-invalid"),d=!1):/[^0-9\.]/g.test($("#modalAddEditNasabah #saldo_antam").val())&&($("#formAddEditNasabah #saldo_antam").addClass("is-invalid"),showAlert({message:"<strong>Saldo hanya boleh angka dan titik</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),d=!1),""==$("#formAddEditNasabah #saldo_ubs").val()?($("#formAddEditNasabah #saldo_ubs").addClass("is-invalid"),d=!1):/[^0-9\.]/g.test($("#modalAddEditNasabah #saldo_ubs").val())&&($("#formAddEditNasabah #saldo_ubs").addClass("is-invalid"),showAlert({message:"<strong>Saldo hanya boleh angka dan titik</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),d=!1),""==$("#formAddEditNasabah #saldo_galery24").val()?($("#formAddEditNasabah #saldo_galery24").addClass("is-invalid"),d=!1):/[^0-9\.]/g.test($("#modalAddEditNasabah #saldo_galery24").val())&&($("#formAddEditNasabah #saldo_galery24").addClass("is-invalid"),showAlert({message:"<strong>Saldo hanya boleh angka dan titik</strong>",btnclose:!1,type:"danger"}),setTimeout(()=>{hideAlert()},3e3),d=!1),""==$("#formAddEditNasabah #tgllahir").val()&&($("#formAddEditNasabah #tgllahir").addClass("is-invalid"),$("#formAddEditNasabah #tgllahir-error").html("*tgl lahir harus di isi"),d=!1),""==$("#formAddEditNasabah input[name=kelamin]").val()&&($(".form-check-input").addClass("is-invalid"),d=!1),""==$("#formAddEditNasabah #alamat").val()?($("#formAddEditNasabah #alamat").addClass("is-invalid"),$("#formAddEditNasabah #alamat-error").html("*alamat harus di isi"),d=!1):$("#formAddEditNasabah #alamat").val().length>255&&($("#formAddEditNasabah #alamat").addClass("is-invalid"),$("#formAddEditNasabah #alamat-error").html("*maksimal 255 huruf"),d=!1),""==$("#formAddEditNasabah #notelp").val()?($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").html("*no.telp harus di isi"),d=!1):$("#formAddEditNasabah #notelp").val().length>14?($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").html("*maksimal 14 huruf"),d=!1):/^\d+$/.test($("#formAddEditNasabah #notelp").val())||($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").html("*hanya boleh angka"),d=!1),d},hapusNasabah=(a,d)=>{Swal.fire({title:"ANDA YAKIN?",text:"Semua data transaksi dan saldo nasabah akan ikut terhapus",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(s=>{s.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:s=>{let t=new FormData;return t.append("hashedpass",PASSADMIN),t.append("password",s),axios.post(`${APIURL}/admin/confirmdelete`,t,{headers:{}}).then(s=>httpRequestDelete(`${APIURL}/admin/deletenasabah?id=${d}`).then(s=>{201==s.status&&(a.parentElement.parentElement.remove(),arrayNasabah=arrayNasabah.filter(a=>a.id!=d),0==arrayNasabah.length&&($("#list-nasabah-notfound").removeClass("d-none"),$("#list-nasabah-notfound #text-notfound").html("nasabah belum ditambah")))})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})};