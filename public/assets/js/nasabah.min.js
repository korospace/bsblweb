function validateFormEditProfile(a){let t=!0,e=a.get("kelamin");return $("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html(""),""==$("#nama-edit").val()?($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*nama lengkap harus di isi"),t=!1):$("#nama-edit").val().length>40&&($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*maksimal 40 huruf"),t=!1),""==$("#username-edit").val()?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*username harus di isi"),t=!1):$("#username-edit").val().length<8||$("#username-edit").val().length>20?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#username-edit").val())&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*tidak boleh ada spasi"),t=!1),""==$("#tgllahir-edit").val()&&($("#tgllahir-edit").addClass("is-invalid"),$("#tgllahir-edit-error").html("*tgl lahir harus di isi"),t=!1),null==e&&($("#formEditProfile .form-check-input").addClass("is-invalid"),t=!1),""==$("#alamat-edit").val()?($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*alamat harus di isi"),t=!1):$("#alamat-edit").val().length>255&&($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*maksimal 255 huruf"),t=!1),""==$("#notelp-edit").val()?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*no.telp harus di isi"),t=!1):$("#notelp-edit").val().length>14?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*maksimal 14 huruf"),t=!1):/^\d+$/.test($("#notelp-edit").val())||($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*hanya boleh angka"),t=!1),""!==$("#newpass-edit").val()&&($("#newpass-edit").val().length<8||$("#newpass-edit").val().length>20?($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#newpass-edit").val())&&($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*tidak boleh ada spasi"),t=!1),""==$("#oldpass-edit").val()&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").html("*password lama harus di isi"),t=!1)),t}let pageTitle=document.title.replace(/\s/g,"").split("|"),dataNasabah="";const httpRequestGet=a=>axios.get(a,{headers:{token:TOKEN}}).then(a=>({status:200,data:a.data})).catch(a=>{if(401==a.response.status)"token expired"==a.response.data.messages?Swal.fire({icon:"error",title:"<strong>LOGIN EXPIRED</strong>",text:"silahkan login ulang untuk perbaharui login anda",showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/login`),document.cookie="token=null;expires=;path=/;"}):(window.location.replace(`${BASEURL}/login`),document.cookie="token=null;expires=;path=/;");else{if(404==a.response.status)return{status:404};showAlert({message:"<strong>Ups...</strong> terjadi kesalahan pada server, silahkan refresh halaman.",btnclose:!0,type:"danger"})}}),sessioncheck=async()=>{showLoadingSpinner();let a=await httpRequestGet(`${APIURL}/nasabah/sessioncheck`);hideLoadingSpinner();let t=(new Date).toLocaleString("en-US",{month:"numeric"}),e=(new Date).toLocaleString("en-US",{year:"numeric"});$(`#filter-month option[value=${t}]`).attr("selected","selected"),$("#filter-year").val(e),200===a.status&&("dashboard"===pageTitle[1]&&(getTotalSampah(),getAllTransaksi(`${t}-${e}`),getDataSaldo(),getDataProfile(),getAllJenisSampah()),"profile"===pageTitle[1]&&getDataProfile())};sessioncheck();const getTotalSampah=async()=>{let a=await httpRequestGet(`${APIURL}/sampah/totalitem`);if(200===a.status){let t=a.data.data;for(const a in t)$(`#sampah-${a}`).html(t[a].total+" Kg")}};$(".filter-transaksi").on("input",function(a){4==$("#filter-year").val().length&&(chartGrafik.destroy(),getAllTransaksi(`${$("#filter-month").val()}-${$("#filter-year").val()}`))});const getAllTransaksi=async a=>{$(".spinner-wraper").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?date=${a}`);if($(".spinner-wraper").addClass("d-none"),404===t.status)updateGrafikSetor([],[]),$("#transaksi-wraper").html("<h6 class='opacity-6'>belum ada transaksi</h6>");else if(200===t.status){let a=[],e=[],s="",n=t.data.data;n.forEach(t=>{let n=t.type,i=t.jenis_saldo,l="",d=new Date(1e3*parseInt(t.date)),r=d.toLocaleString("en-US",{day:"numeric"}),o=d.toLocaleString("en-US",{month:"long"}),m=d.toLocaleString("en-US",{year:"numeric"}),p="";"setor"==n?(l="text-success",p="+Rp"+modifUang(t[`total_${n}`]),a.push(t.id_transaksi),e.push(t.total_kg)):"tarik"==n?(l="text-danger",p="uang"==i?"-Rp"+modifUang(t[`total_${n}`]):t[`total_${n}`]+"g"):(l="text-warning",p="uang"==i?"Rp"+modifUang(t[`total_${n}`]):t[`total_${n}`]+"g"),s+=`<li class="list-group-item border-0 ps-0 border-radius-lg">\n            <div class="d-flex justify-content-between">\n                <div class="d-flex flex-column">\n                    <h6 class="mb-1 text-dark font-weight-bold text-sm">${o}, ${r}, ${m}</h6>\n                    <span class="text-xs">ID: ${t.id_transaksi}</span>\n                    <span class="${l} mt-2">${p}</span>\n                </div>\n                <div class="d-flex align-items-center text-sm">\n                    <a href='' class="btn btn-link text-dark text-sm mb-0 px-0 ms-4"  data-toggle="modal" data-target="#modalPrintTransaksi" onclick="getDetailTransaksi('${t.id_transaksi}');">\n                        <i class="fas fa-file-pdf text-lg me-1"></i> PDF\n                    </a>\n                </div>\n            </div>\n            <hr class="horizontal dark mt-2">\n        </li>`}),updateGrafikSetor(a,e),$("#transaksi-wraper").html(`<ul class="list-group h-100 w-100" style="font-family: 'qc-medium';">\n            ${s}\n        </ul>`)}},modifUang=a=>a.replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,",");let chartGrafik="";const updateGrafikSetor=(a,t)=>{var e=document.getElementById("chart-line").getContext("2d");document.querySelector("#chart-line").style.width="100%",document.querySelector("#chart-line").style.maxHeight="300px";var s=e.createLinearGradient(0,230,0,50);s.addColorStop(1,"rgba(193,217,102,0.2)");var n=e.createLinearGradient(0,230,0,50);n.addColorStop(1,"rgba(193,217,102,0.2)");for(let t=a.length;t<10;t++)a.push(" ");chartGrafik=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Kg",tension:.4,borderWidth:0,pointRadius:0,borderColor:"#c1d966",borderWidth:3,backgroundColor:s,fill:!0,data:t,maxBarThickness:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{drawBorder:!1,display:!0,drawOnChartArea:!0,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,padding:10,color:"#b2b9bf",font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,color:"#b2b9bf",padding:0,font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}}}}})},getDetailTransaksi=async a=>{$("#detil-transaksi-body").html(" "),$("#detil-transaksi-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?id_transaksi=${a}`);if(200===t.status){$("#detil-transaksi-spinner").addClass("d-none");let a=new Date(1e3*parseInt(t.data.data.date));if($("#detil-transaksi-date").html(`${a.toLocaleString("en-US",{day:"numeric"})}/${a.toLocaleString("en-US",{month:"numeric"})}/${a.toLocaleString("en-US",{year:"numeric"})}&nbsp;&nbsp;&nbsp;${a.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}`),$("#detil-transaksi-nama").html(t.data.data.nama_lengkap),$("#detil-transaksi-idnasabah").html(t.data.data.id_nasabah),$("#detil-transaksi-idtransaksi").html(t.data.data.id_transaksi),$("#detil-transaksi-type").html("setor"==t.data.data.type?t.data.data.type+" sampah":t.data.data.type+" saldo"),$("#btn-cetak-transaksi").attr("href",`${BASEURL}/nasabah/cetaktransaksi/${t.data.data.id_transaksi}`),"tarik"==t.data.data.type){let a="uang"==t.data.data.jenis_saldo?"Rp "+modifUang(t.data.data.jumlah):t.data.data.jumlah+" gram";$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n                <h4><strong>Jumlah</strong> : ${a}</h4>\n            </div>`)}if("pindah"==t.data.data.type){let a="uang"==t.data.data.jenis_saldo?"Rp "+modifUang(t.data.data.jumlah):t.data.data.jumlah+" gram",e="uang"!==t.data.data.asal?"Rp "+modifUang(t.data.data.hasil_konversi):t.data.data.hasil_konversi+" gram";$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n            <table>\n                <tr class="text-dark">\n                    <td>Saldo asal&nbsp;&nbsp;&nbsp;</td>\n                    <td>: ${t.data.data.asal}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Saldo tujuan&nbsp;&nbsp;&nbsp;</td>\n                    <td>: ${t.data.data.tujuan}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Jumlah&nbsp;&nbsp;&nbsp;</td>\n                    <td>: ${a}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Harga emas&nbsp;&nbsp;&nbsp;</td>\n                    <td>: Rp ${modifUang(t.data.data.harga_emas)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Hasil konversi&nbsp;&nbsp;&nbsp;</td>\n                    <td>: ${e}</td>\n                </tr>\n            </table>\n            </div>`)}if("setor"==t.data.data.type){let a="",e=t.data.data.barang;e.forEach((t,e)=>{a+=`<tr class="text-center">\n                    <th scope="row">${++e}</th>\n                    <td>${t.jenis_sampah}</td>\n                    <td>${t.jumlah}</td>\n                    <td>Rp ${modifUang(t.harga)}</td>\n                </tr>`}),$("#detil-transaksi-body").html(`<table class="table table-striped">\n                <thead>\n                    <tr>\n                        <th scope="col">#</th>\n                        <th scope="col">Jenis sampah</th>\n                        <th scope="col">Jumlah</th>\n                        <th scope="col">Harga</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${a}\n                </tbody>\n            </table>`)}}},getDataSaldo=async()=>{let a=await httpRequestGet(`${APIURL}/nasabah/getsaldo`);200===a.status&&($("#saldo-uang").html(modifUang(a.data.data.uang)),$("#saldo-ubs").html(parseFloat(a.data.data.ubs).toFixed(4)),$("#saldo-antam").html(parseFloat(a.data.data.antam).toFixed(4)),$("#saldo-galery24").html(parseFloat(a.data.data.galery24).toFixed(4)))},getAllJenisSampah=async()=>{$("#search-sampah").val(""),$("#list-sampah-notfound").addClass("d-none"),$("#table-jenis-sampah").addClass("d-none"),$("#list-sampah-spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/sampah/getitem`);if($("#table-jenis-sampah").removeClass("d-none"),$("#list-sampah-spinner").addClass("d-none"),404===a.status)$("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("jenis sampah belum ditambah");else if(200===a.status){let t="",e=sortingSampah(a.data.data);arrayJenisSampah=e,e.forEach((a,e)=>{t+=`<tr class="text-xs">\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold"> ${++e} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                     <span class="font-weight-bold"> ${a.kategori} </span>\n                 </td>\n                 <td class="align-middle text-center">\n                    ${a.jenis}\n                 </td>\n                 <td class="align-middle text-center py-3">\n                     <span class="font-weight-bold">Rp. ${modifUang(a.harga)} </span>\n                 </td>\n             </tr>`}),$("#table-jenis-sampah tbody").html(t)}},sortingSampah=a=>{let t=[],e={},s=[];a.forEach(a=>{t.includes(a.kategori)||t.push(a.kategori.replace(/\s/g,"_"))}),t.forEach(t=>{e[t]=a.filter(a=>a.kategori==t.replace(/_/g," "))});for(let a in e)e[a].forEach(a=>{s.push(a)});return s},getDataProfile=async()=>{let a=await httpRequestGet(`${APIURL}/nasabah/getprofile`);200===a.status&&(dataNasabah=a.data.data,"dashboard"==pageTitle[1]?updateNasabahCard(dataNasabah):"profile"==pageTitle[1]&&updatePersonalInfo(dataNasabah))},updateNasabahCard=a=>{let t=new Date(1e3*parseInt(a.created_at));$("#card-id").html(`${a.id.slice(0,5)}&nbsp;&nbsp;&nbsp;${a.id.slice(5,9)}&nbsp;&nbsp;&nbsp;${a.id.slice(9,99999999)}`),$("#card-username").html(a.username),$("#card-date").html(`${t.toLocaleString("en-US",{day:"numeric"})}/${t.toLocaleString("en-US",{month:"numeric"})}/${t.toLocaleString("en-US",{year:"numeric"})}`)},updatePersonalInfo=a=>{$("#email").html(a.email),$("#idnasabah").html(a.id),$("#nama-lengkap").html(a.nama_lengkap),$("#username").html(a.username),$("#tgl-lahir").html(a.tgl_lahir),$("#kelamin").html(a.kelamin),$("#alamat").html(a.alamat),$("#notelp").html(a.notelp)};$("#btn-edit-profile").on("click",function(a){a.preventDefault(),$("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html("");for(const a in dataNasabah)$(`#formEditProfile input[name=${a}]`).val(dataNasabah[a]);let t=dataNasabah.tgl_lahir.split("-");$("#formEditProfile input[name=tgl_lahir]").val(`${t[2]}-${t[1]}-${t[0]}`),$(`#formEditProfile input#kelamin-${dataNasabah.kelamin}`).prop("checked",!0),$("#newpass-edit").val(""),$("#oldpass-edit").val("")}),$("#formEditProfile .form-check-input").on("click",function(a){$("#formEditProfile input[name=kelamin]").val($(this).val()),$("#formEditProfile .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formEditProfile").on("submit",function(a){a.preventDefault();let t=new FormData(a.target);if(validateFormEditProfile(t)){let a=t.get("tgl_lahir").split("-");t.set("tgl_lahir",`${a[2]}-${a[1]}-${a[0]}`),""==t.get("new_password")&&t.delete("new_password"),$("#formEditProfile button#submit #text").addClass("d-none"),$("#formEditProfile button#submit #spinner").removeClass("d-none"),axios.put(`${APIURL}/nasabah/editprofile`,t,{headers:{token:TOKEN}}).then(a=>{$("#formEditProfile button#submit #text").removeClass("d-none"),$("#formEditProfile button#submit #spinner").addClass("d-none"),$("#newpass-edit").val(""),$("#oldpass-edit").val("");let e={};for(var s of t.entries())e[s[0]]=s[1];dataNasabah=e,updatePersonalInfo(e),showAlert({message:"<strong>Success...</strong> edit profile berhasil!",btnclose:!1,type:"success"}),setTimeout(()=>{hideAlert()},3e3)}).catch(a=>{$("#formEditProfile button#submit #text").removeClass("d-none"),$("#formEditProfile button#submit #spinner").addClass("d-none"),400==a.response.status?(a.response.data.messages.username&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").text("*"+a.response.data.messages.username)),a.response.data.messages.notelp&&($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").text("*"+a.response.data.messages.notelp)),a.response.data.messages.old_password&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").text("*"+a.response.data.messages.old_password))):500==a.response.status&&showAlert({message:"<strong>Ups . . .</strong> terjadi kesalahan pada server, coba sekali lagi",btnclose:!0,type:"danger"})})}}),$("#btn-logout").on("click",function(a){a.preventDefault(),Swal.fire({title:"LOGOUT",text:"Anda yakin ingin keluar dari dashboad?",icon:"question",showCancelButton:!0,confirmButtonText:"iya",cancelButtonText:"tidak",showLoaderOnConfirm:!0,preConfirm:()=>axios.delete(`${APIURL}/nasabah/logout`,{headers:{token:TOKEN}}).then(()=>{Swal.close(),document.cookie="token=null; path=/;",window.location.replace(`${BASEURL}/login`)}).catch(a=>{Swal.close(),401==a.response.status?(document.cookie="token=null; path=/;",window.location.replace(`${BASEURL}/login`)):500==a.response.status&&Swal.showValidationMessage("server error: coba sekali lagi!")}),allowOutsideClick:()=>!Swal.isLoading()})});